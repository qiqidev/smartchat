(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const y of o.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&n(y)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const ye=64*1024,Ue=5*1e3,Be=5*1e3;function me(i){const e=new Uint8Array(i);for(let t=0;t<i;t++)e[t]=Math.random()*256|0;return e}function Ie(){if(typeof globalThis>"u")return null;const i={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return i.RTCPeerConnection?i:null}function f(i,e){return Object.defineProperty(i,"code",{value:e,enumerable:!0,configurable:!0}),i}function be(i){return i.replace(/a=ice-options:trickle\s\n/g,"")}function qe(i){console.warn(i)}class j{constructor(e={}){if(this._map=new Map,this._id=me(4).toString("hex").slice(0,7),this._doDebug=e.debug,this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||me(20).toString("hex"):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||j.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},j.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.streams=e.streams||(e.stream?[e.stream]:[]),this.trickle=e.trickle!==void 0?e.trickle:!0,this.allowHalfTrickle=e.allowHalfTrickle!==void 0?e.allowHalfTrickle:!1,this.iceCompleteTimeout=e.iceCompleteTimeout||Ue,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=e.wrtc&&typeof e.wrtc=="object"?e.wrtc:Ie(),!this._wrtc)throw f(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(t){this.destroy(f(t,"ERR_PC_CONSTRUCTOR"));return}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(t=>{this.destroy(f(t,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this.streams&&this.streams.forEach(t=>{this.addStream(t)}),this._pc.ontrack=t=>{this._onTrack(t)},this._debug("initial negotiation"),this._needsNegotiation()}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(e){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof e=="string")try{e=JSON.parse(e)}catch{e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(t=>{this._addIceCandidate(t)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(t=>{this.destroy(f(t,"ERR_SET_REMOTE_DESCRIPTION"))}),!e.sdp&&!e.candidate&&!e.renegotiate&&!e.transceiverRequest&&this.destroy(f(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(e){const t=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(t).catch(n=>{!t.address||t.address.endsWith(".local")?qe("Ignoring unsupported ICE candidate."):this.destroy(f(n,"ERR_ADD_ICE_CANDIDATE"))})}send(e){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(e)}}addTransceiver(e,t){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(n){this.destroy(f(n,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:e,init:t}})}}addStream(e){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),e.getTracks().forEach(t=>{this.addTrack(t,e)})}}addTrack(e,t){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const n=this._senderMap.get(e)||new Map;let r=n.get(t);if(!r)r=this._pc.addTrack(e,t),n.set(t,r),this._senderMap.set(e,n),this._needsNegotiation();else throw r.removed?f(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):f(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(e,t,n){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const r=this._senderMap.get(e),o=r?r.get(n):null;if(!o)throw f(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,r),o.replaceTrack!=null?o.replaceTrack(t):this.destroy(f(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(e,t){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const n=this._senderMap.get(e),r=n?n.get(t):null;if(!r)throw f(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{r.removed=!0,this._pc.removeTrack(r)}catch(o){o.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(r):this.destroy(f(o,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(e){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),e.getTracks().forEach(t=>{this.removeTrack(t,e)})}}_needsNegotiation(){this._debug("_needsNegotiation"),!this._batchedNegotiation&&(this._batchedNegotiation=!0,queueMicrotask(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(e){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),queueMicrotask(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",e&&(e.message||e)),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close")}))}_setupData(e){if(!e.channel)return this.destroy(f(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=ye),this.channelName=this._channel.label,this._channel.onmessage=n=>{this._onChannelMessage(n)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=n=>{this.destroy(f(n,"ERR_DATA_CHANNEL"))};let t=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(t&&this._onChannelClose(),t=!0):t=!1},Be)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=be(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp})},n=()=>{this._debug("createOffer success"),!this.destroyed&&(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},r=o=>{this.destroy(f(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(n).catch(r)}).catch(e=>{this.destroy(f(e,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(e=>{!e.mid&&e.sender.track&&!e.requested&&(e.requested=!0,this.addTransceiver(e.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(e=>{if(this.destroyed)return;!this.trickle&&!this.allowHalfTrickle&&(e.sdp=be(e.sdp)),e.sdp=this.sdpTransform(e.sdp);const t=()=>{if(this.destroyed)return;const o=this._pc.localDescription||e;this._debug("signal"),this.emit("signal",{type:o.type,sdp:o.sdp}),this.initiator||this._requestMissingTransceivers()},n=()=>{this.destroyed||(this.trickle||this._iceComplete?t():this.once("_iceComplete",t))},r=o=>{this.destroy(f(o,"ERR_SET_LOCAL_DESCRIPTION"))};this._pc.setLocalDescription(e).then(n).catch(r)}).catch(e=>{this.destroy(f(e,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(f(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),(e==="connected"||e==="completed")&&(this._pcReady=!0,this._maybeReady()),e==="failed"&&this.destroy(f(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),e==="closed"&&this.destroy(f(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(e){const t=n=>(Object.prototype.toString.call(n.values)==="[object Array]"&&n.values.forEach(r=>{Object.assign(n,r)}),n);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(n=>{const r=[];n.forEach(o=>{r.push(t(o))}),e(null,r)},n=>e(n)):this._pc.getStats.length>0?this._pc.getStats(n=>{if(this.destroyed)return;const r=[];n.result().forEach(o=>{const y={};o.names().forEach(S=>{y[S]=o.stat(S)}),y.id=o.id,y.type=o.type,y.timestamp=o.timestamp,r.push(t(y))}),e(null,r)},n=>e(n)):e(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const e=()=>{this.destroyed||this.getStats((t,n)=>{if(this.destroyed)return;t&&(n=[]);const r={},o={},y={};let S=!1;n.forEach(h=>{(h.type==="remotecandidate"||h.type==="remote-candidate")&&(r[h.id]=h),(h.type==="localcandidate"||h.type==="local-candidate")&&(o[h.id]=h),(h.type==="candidatepair"||h.type==="candidate-pair")&&(y[h.id]=h)});const A=h=>{S=!0;let p=o[h.localCandidateId];p&&(p.ip||p.address)?(this.localAddress=p.ip||p.address,this.localPort=Number(p.port)):p&&p.ipAddress?(this.localAddress=p.ipAddress,this.localPort=Number(p.portNumber)):typeof h.googLocalAddress=="string"&&(p=h.googLocalAddress.split(":"),this.localAddress=p[0],this.localPort=Number(p[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let b=r[h.remoteCandidateId];b&&(b.ip||b.address)?(this.remoteAddress=b.ip||b.address,this.remotePort=Number(b.port)):b&&b.ipAddress?(this.remoteAddress=b.ipAddress,this.remotePort=Number(b.portNumber)):typeof h.googRemoteAddress=="string"&&(b=h.googRemoteAddress.split(":"),this.remoteAddress=b[0],this.remotePort=Number(b[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(n.forEach(h=>{h.type==="transport"&&h.selectedCandidatePairId&&A(y[h.selectedCandidatePairId]),(h.type==="googCandidatePair"&&h.googActiveConnection==="true"||(h.type==="candidatepair"||h.type==="candidate-pair")&&h.selected)&&A(h)}),!S&&(!Object.keys(y).length||Object.keys(o).length)){setTimeout(e,100);return}else this._connecting=!1,this._connected=!0;if(this._chunk){try{this.send(this._chunk)}catch(p){return this.destroy(f(p,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const h=this._cb;this._cb=null,h(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};e()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>ye||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(e=>{this._pc.removeTrack(e),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):!e.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(e){if(this.destroyed)return;let t=e.data;t instanceof ArrayBuffer&&(t=new Uint8Array(t)),this.emit("data",t)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const e=this._cb;this._cb=null,e(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(e){this.destroyed||e.streams.forEach(t=>{this._debug("on track"),this.emit("track",e.track,t),this._remoteTracks.push({track:e.track,stream:t}),!this._remoteStreams.some(n=>n.id===t.id)&&(this._remoteStreams.push(t),queueMicrotask(()=>{this._debug("on stream"),this.emit("stream",t)}))})}_debug(...e){this._doDebug&&(e[0]="["+this._id+"] "+e[0],console.log(...e))}on(e,t){const n=this._map;n.has(e)||n.set(e,new Set),n.get(e).add(t)}off(e,t){const n=this._map,r=n.get(e);r&&(r.delete(t),r.size===0&&n.delete(e))}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}emit(e,...t){const n=this._map;if(n.has(e))for(const r of n.get(e))try{r(...t)}catch(o){console.error(o)}}}j.WEBRTC_SUPPORT=!!Ie();j.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};j.channelConfig={};const Ee="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",we=(i,e,t)=>{const n=new j({initiator:i,trickle:e,config:t}),r=o=>n.__earlyDataBuffer.push(o);return n.on(T.data,r),n.__earlyDataBuffer=[],n.__drainEarlyData=o=>{n.off(T.data,r),n.__earlyDataBuffer.forEach(o),delete n.__earlyDataBuffer,delete n.__drainEarlyData},n},Pe=i=>Array(i).fill().map(()=>Ee[Math.floor(Math.random()*Ee.length)]).join(""),$e=(i,e)=>(t,n)=>{if(i[n])return i[n];if(!t)throw O("requires a config map as the first argument");if(!t.appId&&!t.firebaseApp)throw O("config map is missing appId field");if(!n)throw O("namespace argument required");return i[n]=e(t,n)},Z="Trystero",oe=Pe(20),{keys:xe,values:He,entries:le,fromEntries:ue}=Object,x=()=>{},O=i=>new Error(`${Z}: ${i}`),W=i=>new TextEncoder().encode(i),ae=i=>new TextDecoder().decode(i),T=ue(["close","connect","data","error","signal","stream","track"].map(i=>[i,i])),je=(i,e,t)=>(i.relayUrls||e).slice(0,i.relayUrls?i.relayUrls.length:i.relayRedundancy||t),Je=i=>new Promise(e=>setTimeout(e,i)),Fe=Object.getPrototypeOf(Uint8Array),ce=12,ve=0,de=ve+ce,he=de+1,X=he+1,Q=X+1,$=16*2**10-Q,re=255,Ce="bufferedamountlow",We=(i,e)=>{const t={},n={},r={},o={},y={},S={},A=(s,a)=>(s?Array.isArray(s)?s:[s]:xe(t)).flatMap(g=>{const l=t[g];return l?a(g,l):(console.warn(`${Z}: no peer with id ${g} found`),[])}),h=s=>{t[s]&&(delete t[s],delete r[s],delete o[s],E(s))},p=s=>{if(n[s])return[n[s].send,n[s].setOnComplete,n[s].setOnProgress];if(!s)throw O("action type argument is required");const a=W(s);if(a.byteLength>ce)throw O(`action type string "${s}" (${a.byteLength}b) exceeds byte limit (${ce}). Hint: choose a shorter name.`);const g=new Uint8Array(ce);g.set(a);let l=0;return n[s]={onComplete:x,onProgress:x,setOnComplete:u=>n[s]={...n[s],onComplete:u},setOnProgress:u=>n[s]={...n[s],onProgress:u},send:async(u,I,R,z)=>{if(R&&typeof R!="object")throw O("action meta argument must be an object");if(u===void 0)throw O("action data cannot be undefined");const se=typeof u!="string",ie=u instanceof Blob,G=ie||u instanceof ArrayBuffer||u instanceof Fe;if(R&&!G)throw O("action meta argument can only be used with binary data");const F=G?new Uint8Array(ie?await u.arrayBuffer():u):W(se?JSON.stringify(u):u),N=R?W(JSON.stringify(R)):null,v=Math.ceil(F.byteLength/$)+(R?1:0)||1,D=Array(v).fill().map((U,P)=>{const B=P===v-1,q=R&&P===0,L=new Uint8Array(Q+(q?N.byteLength:B?F.byteLength-$*(v-(R?2:1)):$));return L.set(g),L.set([l],de),L.set([B|q<<1|G<<2|se<<3],he),L.set([Math.round((P+1)/v*re)],X),L.set(R?q?N:F.subarray((P-1)*$,P*$):F.subarray(P*$,(P+1)*$),Q),L});return l=l+1&re,Promise.all(A(I,async(U,P)=>{const B=P._channel;let q=0;for(;q<v;){const L=D[q];if(B.bufferedAmount>B.bufferedAmountLowThreshold&&await new Promise(Me=>{const pe=()=>{B.removeEventListener(Ce,pe),Me()};B.addEventListener(Ce,pe)}),!t[U])break;P.send(L),q++,z&&z(L[X]/re,U,R)}}))}},[n[s].send,n[s].setOnComplete,n[s].setOnProgress]},b=(s,a)=>{const g=new Uint8Array(a),l=ae(g.subarray(ve,de)).replaceAll("\0",""),[u]=g.subarray(de,he),[I]=g.subarray(he,X),[R]=g.subarray(X,Q),z=g.subarray(Q),se=!!(I&1),ie=!!(I&2),G=!!(I&4),F=!!(I&8);if(!n[l])throw O(`received message with unregistered type (${l})`);r[s]||(r[s]={}),r[s][l]||(r[s][l]={});let N=r[s][l][u];if(N||(N=r[s][l][u]={chunks:[]}),ie?N.meta=JSON.parse(ae(z)):N.chunks.push(z),n[l].onProgress(R/re,s,N.meta),!se)return;const v=new Uint8Array(N.chunks.reduce((D,U)=>D+U.byteLength,0));if(N.chunks.reduce((D,U)=>(v.set(U,D),D+U.byteLength),0),G)n[l].onComplete(v,s,N.meta);else{const D=ae(v);n[l].onComplete(F?JSON.parse(D):D,s)}delete r[s][l][u]},[ee,te]=p("__91n6__"),[J,Y]=p("__90n6__"),[ne,M]=p("__516n4L__"),[k,c]=p("__57r34m__"),[_,m]=p("__7r4ck__");let d=x,E=x,w=x,C=x;return i((s,a)=>{if(t[a])return;const g=b.bind(null,a);t[a]=s,s.on(T.signal,l=>ne(l,a)),s.on(T.close,()=>h(a)),s.on(T.data,g),s.on(T.stream,l=>{w(l,a,y[a]),delete y[a]}),s.on(T.track,(l,u)=>{C(l,u,a,S[a]),delete S[a]}),s.on(T.error,l=>{l.code!=="ERR_DATA_CHANNEL"&&console.error(l)}),d(a),s.__drainEarlyData(g)}),te((s,a)=>J("",a)),Y((s,a)=>{o[a]&&(o[a](),delete o[a])}),M((s,a)=>{t[a]&&t[a].signal(s)}),c((s,a)=>y[a]=s),m((s,a)=>S[a]=s),{makeAction:p,ping:async s=>{if(!s)throw O("ping() must be called with target peer ID");const a=Date.now();return ee("",s),await new Promise(g=>o[s]=g),Date.now()-a},leave:()=>{le(t).forEach(([s,a])=>{a.destroy(),delete t[s]}),e()},getPeers:()=>ue(le(t).map(([s,a])=>[s,a._pc])),addStream:(s,a,g)=>A(a,async(l,u)=>{g&&await k(g,l),u.addStream(s)}),removeStream:(s,a)=>A(a,(g,l)=>l.removeStream(s)),addTrack:(s,a,g,l)=>A(g,async(u,I)=>{l&&await _(l,u),I.addTrack(s,a)}),removeTrack:(s,a,g)=>A(g,(l,u)=>u.removeTrack(s,a)),replaceTrack:(s,a,g,l,u)=>A(l,async(I,R)=>{u&&await _(u,I),R.replaceTrack(s,a,g)}),onPeerJoin:s=>d=s,onPeerLeave:s=>E=s,onPeerStream:s=>w=s,onPeerTrack:s=>C=s}},_e="AES-CBC",Ye=i=>btoa(String.fromCharCode.apply(null,new Uint8Array(i))),ze=i=>{const e=atob(i);return new Uint8Array(e.length).map((t,n)=>e.charCodeAt(n)).buffer},Ge=async(i,e)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},W(`${i}:${e}`)),{name:_e},!1,["encrypt","decrypt"]),Re=async(i,e)=>{const t=crypto.getRandomValues(new Uint8Array(16));return JSON.stringify({c:Ye(await crypto.subtle.encrypt({name:_e,iv:t},await i,W(e))),iv:[...t]})},Te=async(i,e)=>{const{c:t,iv:n}=JSON.parse(e);return ae(await crypto.subtle.decrypt({name:_e,iv:new Uint8Array(n)},await i,ze(t)))},Se={},fe={},Ke={},K={},V={},Ae=20,ke=10,Ve=3,Xe=33,Qe=120,Ne=4,Oe="announce",Ze=["wss://tracker.webtorrent.dev","wss://tracker.openwebtorrent.com","wss://tracker.files.fm:7073/announce","wss://tracker.btorrent.xyz"],et=$e(Se,(i,e)=>{if(i.trackerUrls||i.trackerRedundancy)throw O("trackerUrls/trackerRedundancy have been replaced by relayUrls/relayRedundancy");const t={},n=i.password&&Ge(i.password,e),r=je(i,Ze,Ve),o=crypto.subtle.digest("SHA-1",W(`${Z}:${i.appId}:${e}`)).then(c=>Array.from(new Uint8Array(c)).map(_=>_.toString(36)).join("").slice(0,Ae)),y=c=>ue(Array(c).fill().map(()=>{const _=we(!0,!1,i.rtcConfig);return[Pe(Ae),{peer:_,offerP:new Promise(m=>_.once(T.signal,m))}]})),S=async(c,_)=>{const m=await o;let d;try{d=JSON.parse(_.data)}catch{console.error(`${Z}: received malformed SDP JSON`);return}if(d.info_hash!==m||d.peer_id&&d.peer_id===oe)return;const E=d["failure reason"];if(E){console.warn(`${Z}: torrent tracker failure from ${c.url} - ${E}`);return}if(d.interval&&d.interval>J&&d.interval<=Qe&&(clearInterval(Y),J=d.interval,Y=setInterval(p,J*1e3)),d.offer&&d.offer_id){if(t[d.peer_id]||M[d.offer_id])return;M[d.offer_id]=!0;const w=we(!1,!1,i.rtcConfig);w.once(T.signal,async C=>c.send(JSON.stringify({answer:n?{...C,sdp:await Re(n,C.sdp)}:C,action:Oe,info_hash:m,peer_id:oe,to_peer_id:d.peer_id,offer_id:d.offer_id}))),w.on(T.connect,()=>ee(w,d.peer_id)),w.on(T.close,()=>te(w,d.peer_id,d.offer_id)),w.signal(n?{...d.offer,sdp:await Te(n,d.offer.sdp)}:d.offer);return}if(d.answer){if(t[d.peer_id]||M[d.offer_id])return;const w=k[d.offer_id];if(w){const{peer:C}=w;if(C.destroyed)return;M[d.offer_id]=!0,C.on(T.connect,()=>ee(C,d.peer_id,d.offer_id)),C.on(T.close,()=>te(C,d.peer_id,d.offer_id)),C.signal(n?{...d.answer,sdp:await Te(n,d.answer.sdp)}:d.answer)}}},A=async(c,_)=>c.send(JSON.stringify({action:Oe,info_hash:_,numwant:ke,peer_id:oe,offers:await Promise.all(le(k).map(async([m,{offerP:d}])=>{const E=await d;return{offer_id:m,offer:n?{...E,sdp:await Re(n,E.sdp)}:E}}))})),h=(c,_,m)=>(m||!fe[c]?(V[c]={...V[c],[_]:S},fe[c]=new Promise(d=>{const E=new WebSocket(c);Ke[c]=E,E.addEventListener("open",()=>{K[c]=Ne*1e3,d(E)}),E.addEventListener("message",w=>He(V[c]).forEach(C=>C(E,w))),E.addEventListener("close",async()=>{K[c]=K[c]??Ne*1e3,await Je(K[c]),K[c]*=2,h(c,_,!0)})})):V[c][_]=S,fe[c]),p=async()=>{const c=await o;k&&b(),k=y(ke),r.forEach(async _=>{const m=await h(_,c);m.readyState===WebSocket.OPEN?A(m,c):m.readyState!==WebSocket.CONNECTING&&A(await h(_,c,!0),c)})},b=()=>{le(k).forEach(([c,{peer:_}])=>{!M[c]&&!t[c]&&_.destroy()}),M={}},ee=(c,_,m)=>{ne(c,_),t[_]=!0,m&&(t[m]=!0)},te=(c,_,m)=>{delete t[_],c.destroy(),m in k&&(delete k[m],k={...k,...y(1)})};let J=Xe,Y=setInterval(p,J*1e3),ne=x,M={},k;return p(),We(c=>ne=c,async()=>{const c=await o;r.forEach(_=>delete V[_][c]),delete Se[e],clearInterval(Y),b()})}),tt={appId:"smartchat"},ge=et(tt,"testingtesting");ge.onPeerJoin(i=>{console.log(`${i} joined`),H.push(i),console.log(`isi users ${H}`),document.getElementById("circle").innerHTML=H.length,Le("halo",i)});ge.onPeerLeave(i=>{console.log(`${i} left`);let e=[];for(const t of H)t!=i&&e.push(t);H=e,document.getElementById("circle").innerHTML=H.length});const De=oe;console.log(`myid ${De}`);let H=[De];const[Le,nt]=ge.makeAction("chat");nt((i,e)=>{console.log(`ada pesan dari ${e} : data`);const t=e.slice(-4);document.getElementById("message").innerHTML+=`<br>Message from ${t} : ${i}`});document.getElementById("sendnow").onclick=function(){const i=document.getElementById("typing").value;for(const e of H)Le(i,e);document.getElementById("message").innerHTML+=`<br>Me : ${i}`,document.getElementById("typing").value=""};
